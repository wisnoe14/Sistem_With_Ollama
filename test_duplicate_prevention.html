<!DOCTYPE html>
<html>
<head>
    <title>Test Duplicate Prevention</title>
</head>
<body>
    <h1>Test Duplicate History Prevention</h1>
    <div id="results"></div>
    
    <script>
        // Test duplicate prevention logic
        function testDuplicatePrevention() {
            const results = document.getElementById('results');
            
            // Simulate existing history
            const existingHistory = [
                {
                    tanggal: "15/10/2025, 11.10.41",
                    customer_id: "ICON12345",
                    nama: "Budi",
                    topik: "telecollection",
                    status: "KEMUNGKINAN BAYAR",
                    alasan: "Customer berkomitmen timeline (85.0%) namun ada kendala (90.0%)",
                    estimasi_pembayaran: "Target Customer: 16 Oktober 2025 (perlu follow-up)"
                }
            ];
            
            // Test new entry (duplicate)
            const newEntry = {
                tanggal: "15/10/2025, 11.11.00",
                customer_id: "ICON12345", 
                nama: "Budi",
                topik: "telecollection",
                status: "KEMUNGKINAN BAYAR",
                alasan: "Customer berkomitmen timeline (85.0%) namun ada kendala (90.0%)",
                estimasi_pembayaran: "Target Customer: 16 Oktober 2025 (perlu follow-up)"
            };
            
            // Duplicate prevention logic
            function shouldPreventDuplicate(history, newItem) {
                if (history.length > 0) {
                    const lastEntry = history[0];
                    return lastEntry.customer_id === newItem.customer_id && 
                           lastEntry.topik === newItem.topik && 
                           lastEntry.status === newItem.status &&
                           lastEntry.alasan === newItem.alasan;
                }
                return false;
            }
            
            const shouldPrevent = shouldPreventDuplicate(existingHistory, newEntry);
            
            results.innerHTML = `
                <h2>Test Results:</h2>
                <p><strong>Existing History:</strong></p>
                <pre>${JSON.stringify(existingHistory[0], null, 2)}</pre>
                
                <p><strong>New Entry:</strong></p>
                <pre>${JSON.stringify(newEntry, null, 2)}</pre>
                
                <p><strong>Should Prevent Duplicate:</strong> ${shouldPrevent ? '✅ YES' : '❌ NO'}</p>
                
                <h3>Clear localStorage History</h3>
                <button onclick="localStorage.removeItem('simulationHistory'); alert('History cleared!')">Clear History</button>
                
                <h3>Current localStorage History</h3>
                <pre id="current-history">${localStorage.getItem('simulationHistory') || 'No history found'}</pre>
            `;
        }
        
        // Run test on page load
        testDuplicatePrevention();
        
        // Update current history display every second
        setInterval(() => {
            const currentHistory = document.getElementById('current-history');
            if (currentHistory) {
                currentHistory.textContent = localStorage.getItem('simulationHistory') || 'No history found';
            }
        }, 1000);
    </script>
</body>
</html>